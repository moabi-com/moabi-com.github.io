<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="description" content="Moabi : IoT Firmware Security. Moabi SaaS platform is a pro-active security solution to audit software, firmware, binaries and their dependencies.">
    <meta name="keywords" content="Binary analysis, Preventive Software analytics, IoT security, security analytics, preventive security, IIot security, Saas security, scalable security">
    <title>Hostapd fails at seeding PRNGS: CVE-2019-10064</title>

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://moabi.com https://m.moabi.com ; script-src 'self' https://moabi.com https://m.moabi.com https://www.google-analytics.com https://www.googletagmanager.com https://js.hs-scripts.com https://js.hs-analytics.net https://track.hubspot.com 'unsafe-inline'; connect-src 'self' https://moabi.com https://m.moabi.com https://www.google-analytics.com https://www.googletagmanager.com https://js.hs-scripts.com https://js.hs-analytics.net https://track.hubspot.com ; img-src 'self' data: https://moabi.com https://m.moabi.com https://www.google-analytics.com https://track.hubspot.com https://www.googletagmanager.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://moabi.com https://m.moabi.com https://tagmanager.google.com/ https://fonts.googleapis.com/ 'unsafe-inline' ; font-src 'self' https://moabi.com https://m.moabi.com https://fonts.googleapis.com https://fonts.gstatic.com/ ; frame-src https://www.youtube.com/ https://youtube.com/ ; base-uri 'self' https://moabi.com https://m.moabi.com ;" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, minimum-scale=0.86">

    <!-- Json-ld information -->
    <script type="application/ld+json">
	{
		"@context": "http://schema.org",
		"@id": "https://moabi.com/index.html#top",
		"@type": "Organization",
		"name": "Moabi",
		"url": "https://moabi.com/",
		"logo": "https://moabi.com/moabi.png",
		"email": "info(at)moabi.com",
		"description": "Moabi : IoT Firmware Security. Moabi SaaS platform is a pro-active security solution to audit software, firmware, binaries and their dependencies.",
		"address": [
			{
				"@type": "PostalAddress",
				"addressLocality": "Paris, France",
				"postalCode":"75015",
				"streetAddress": "33 Avenue du Maine"
			},
			{
				"@type": "PostalAddress",
				"addressLocality": "San Francisco",
				"addressRegion": "CA",
				"postalCode":"94133",
				"streetAddress": "1640 Stockton Street",
				"postOfficeBoxNumber": "330143"
			}
		],
		"contactPoint": [
			{
				"@type": "ContactPoint",
				"telephone": "+33188335053",
				"email": "info(at)moabi.com",
				"contactType": "sales"
			},
			{
				"@type": "ContactPoint",
				"email": "moabi(at)moabi.com",
				"contactType": "customer service",
				"url": "https://moabi.com"
			}
		],
		"sameAs": [
			"https://blog.moabi.com",
			"https://cve.moabi.com",
			"https://www.facebook.com/Moabi.info/",
			"https://twitter.com/moabi_com",
			"https://www.instagram.com/endrazine/",
			"https://www.pinterest.com/moabi_security/",
			"https://www.reddit.com/user/moabi_com",
			"https://mix.com/moabi",
			"https://moabi-com.tumblr.com",
			"https://disqus.com/by/moabi_com/",
			"https://www.behance.net/moabi",
			"https://soundcloud.com/moabi-com",
			"https://www.diigo.com/user/moabicom",
			"https://www.scribd.com/user/65969292/Moabi",
			"https://prezi.com/user/9zvtmizryv1a/",
			"https://www.deviantart.com/moabisecurity",
			"https://moabi-com.tumblr.com/",
			"http://about.me/moabisecurity",
			"https://www.crunchbase.com/organization/moabi",
			"https://www.instapaper.com/p/moabi",
			"https://www.wattpad.com/user/MoabiSecurity",
			"https://themeforest.net/user/moabisecurity",
			"https://github.com/moabi-com/",
			"https://www.pearltrees.com/moabi",
			"https://www.mixcloud.com/moabi-com",
			"http://slideshare.net/endrazine/",
			"https://www.linkedin.com/company/moabi-com",
			"https://www.youtube.com/moabi",
			"https://moabi-security.business.site",
			"https://www.dailymotion.com/dm_0998e97942f47ad8db363dc97476c53e",
			"https://www.hotfrog.com/company/1235179870674944"
		]
	}
    </script>

    <!-- Open Graph metadata -->
    <meta property="og:title" content="Moabi" />
    <meta property="og:url" content="https://moabi.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://moabi.com/moabi_card.png" />
    <meta property="og:description" content="Moabi : IoT Firmware Security. Moabi SaaS platform is a pro-active security solution to audit software, firmware, binaries and their dependencies." />
    <meta property="og:site_name" content="Moabi">

    <!-- Twitter card integration (works with Open Graph data above) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Moabi Saas platform : binary analysis">
    <meta name="twitter:site" content="@moabi_com">

    <!-- Yandex indexation -->
    <meta name="yandex-verification" content="e477bac9aff66624" />

    <!-- Bing indexing -->
    <meta name="msvalidate.01" content="E6F45B72576D2C71AD0A5B162DF8117D" />

    <!-- Pinterest indexing -->
    <meta name="p:domain_verify" content="3ff193be13e7fbcb9cdf824778f234c3"/>

    <!-- Preconnect optimization -->
    <link rel="preconnect" href="https://js.hs-scripts.com">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google-analytics.com">

    <!-- Preload optimization -->
   <link rel="preload" href="/fonts/1Ptrg8zYS_SKggPNwIouWqZPBQ.woff2" as="font" type="font/woff2" crossorigin="anonymous">
   <link rel="preload" href="/fonts/1Ptrg8zYS_SKggPNwN4rWqZPBQ.woff2" as="font" type="font/woff2" crossorigin="anonymous">
   <link rel="preload" href="/fonts/1Ptug8zYS_SKggPNyC0ISg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
   <link rel="preload" href="/fonts/1Ptrg8zYS_SKggPNwJYtWqZPBQ.woff2" as="font" type="font/woff2" crossorigin="anonymous">
   <link rel="preload" href="/js/modernizr.js" as="script">
   <link rel="preload" href="/js/jquery-3.4.1.min.js" as="script">
   <link rel="preload" href="/js/lazyload.js" as="script">
   <link rel="preload" href="/js/main.js" as="script">
   <link rel="preload" href="/js/rev.js" as="script">
   <link rel="preload" href="/js/custom.js" as="script">
   <link rel="preload" href="/js/site.js" as="script">

    <link rel="preload" href="/fonts/fontawesome-webfont.woff2?v=4.7.0" as="font" type="font/woff2" crossorigin="anonymous">

    <!-- Canonical name -->
    <link rel="canonical" href="https://moabi.com/advisories/CVE-2019-1006.html" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />  
    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />  
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />  

    <!-- Apple icons -->
    <link rel="apple-touch-icon" sizes="120x120" href="apple-120.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="apple-152.png" />  
    <link rel="apple-touch-icon" sizes="167x167" href="apple-167.png" />  
    <link rel="apple-touch-icon" sizes="180x180" href="apple-180.png" />  

    <!-- Apple Safari -->
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#446CDE" />

    <!-- Microsoft Windows/IE11 Start Screen Tile-->
    <meta name="application-name" content="moabi.com"/>
    <meta name="msapplication-square70x70logo" content="small.jpg"/>
    <meta name="msapplication-square150x150logo" content="medium.jpg"/>
    <meta name="msapplication-wide310x150logo" content="wide.jpg"/>
    <meta name="msapplication-square310x310logo" content="large.jpg"/>
    <meta name="msapplication-TileColor" content="#446CDE">
    <meta name="theme-color" content="#446CDE">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129423028-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-129423028-1');
    </script>

    <!-- Note: stylesheets are loaded twice to make up for the lack of preloading in Firefox. See https://stackoverflow.com/questions/45321043/preload-css-file-not-supported-on-firefox-and-safari-mac -->
    <!-- CSS  Fonts -->
    <link rel="preload" href="/css/font-awesome.min.css" as="style" />
    <link rel="stylesheet" href="/css/font-awesome.min.css">

    <!-- CSS  -->
    <link rel="preload" href="/css/site.css" as="style" />
    <link rel="stylesheet" href="/css/site.css">

</head>
<body bgcolor="white"><pre>
----------------------------------------------------------------------
*               Hostapd fails at seeding PRNGS,                      *
*               leading to insufficient entropy                      *
----------------------------------------------------------------------


--[ Vulnerabilities Summary:

Date Published: 27/02/2020
CVE Names: CVE-2016-10743 and CVE-2019-10064.
Title: Hostapd fails at seeding PRNGs
Class: CWE-331: Insufficient Entropy
Remotely Exploitable: Yes
Locally Exploitable: No
Impact: Remote network access, remote Denial of Service
Advisory URL: https://moabi.com/advisories/CVE-2019-10064.html


--[ Synopsis:

Hostapd (host access point daemon) is a user space daemon software enabling a network
interface card to act as an access point and authentication server. It is powering
billions of IoT devices.

It has been discovered that hostapd before version 2.6 wasn't seeding PRNGs at all.
This vulnerability has been fixed silently around 2016, but never attributed a CVE
number, leading to many distributions and IoT devices still shipping this version of
the software. This vulnerability has been given id CVE-2016-10743.
In some configurations, when WPS is enabled and a /dev/urandom device isn't available,
this leads to WPS PINS being predictable, allowing remote network access from an attacker.

In addition, it has been discovered that the Extensible Authentication Protocol (EAP) mode,
which offers a protection against flooding attacks, also uses predictable PRNGs. This
vulnerability has been assigned id CVE-2019-10064.

--[ Details:

* details for CVE-2016-10743:

CVE-2016-10743 has been silently patched with commit:
98a516eae8260e6fd5c48ddecf8d006285da7389 on http://w1.fi/hostap.git on
Tue Feb 9 14:47:47 2016 +0000 by Nick Lowe <nick.lowe@lugatech.com>

https://wiki.sei.cmu.edu/confluence/display/c/MSC32-C.+Properly+seed+pseudorandom+number+generators

https://github.com/jmalinen/hostap/blob/a06b1070d8902460a9c61a3e13af577327fce6b3/src/utils/os_win32.c
unsigned long os_random(void)

 {

  return rand();

 }


https://github.com/jmalinen/hostap/blob/a06b1070d8902460a9c61a3e13af577327fce6b3/src/utils/os_internal.c

unsigned long os_random(void)

 {

  return random();

 }


https://github.com/jmalinen/hostap/blob/a06b1070d8902460a9c61a3e13af577327fce6b3/src/utils/os_unix.c

unsigned long os_random(void)

 {

  return random();

 }


In all cases, os_random() is not seeded, and therefor entirely predictable and repeatable.

This is exploitable via the WPS PIN generation, as detailed here:

https://github.com/jmalinen/hostap/blob/a06b1070d8902460a9c61a3e13af577327fce6b3/src/wps/wps_common.c

/**

  * wps_generate_pin - Generate a random PIN

  * Returns: Eight digit PIN (i.e., including the checksum digit)

  */

 unsigned int wps_generate_pin(void)

 {

  unsigned int val;

 

  /* Generate seven random digits for the PIN */

  if (random_get_bytes((unsigned char *) &val, sizeof(val)) < 0) {

   struct os_time now;

   os_get_time(&now);

   val = os_random() ^ now.sec ^ now.usec;

  }

  val %= 10000000;

 

  /* Append checksum digit */

  return val * 10 + wps_pin_checksum(val);

 }



* details for CVE-2019-10064:

The EAP mode features a flood prevention technique, which is defeated due to lack of proper seeding of PRNGs:

https://github.com/jmalinen/hostap/blob/a06b1070d8902460a9c61a3e13af577327fce6b3/src/eap_server/eap_server_pwd.c



 static void eap_pwd_build_id_req(struct eap_sm *sm, struct eap_pwd_data *data,

      u8 id)

 {

  wpa_printf(MSG_DEBUG, "EAP-pwd: ID/Request");

  /*

   * if we're fragmenting then we already have an id request, just return

   */

  if (data->out_frag_pos)

   return;

 

  data->outbuf = wpabuf_alloc(sizeof(struct eap_pwd_id) +

         data->id_server_len);

  if (data->outbuf == NULL) {

   eap_pwd_state(data, FAILURE);

   return;

  }

 

  /* an lfsr is good enough to generate unpredictable tokens */

  data->token = os_random();

  wpabuf_put_be16(data->outbuf, data->group_num);

  wpabuf_put_u8(data->outbuf, EAP_PWD_DEFAULT_RAND_FUNC);

  (etc.)

--[ Suggested patch:

It is recommended to seed PRNGs by reading /dev/urandom, for instance
using the routine below:

/**
* Get a random seed
*/
int getseed(void) {
        int fd;
        int r, n;

	fd = open("/dev/urandom", O_RDONLY);
        if (fd < 0) {
                perror("open");
                exit(0);
        }
        n = read(fd, &r, sizeof(r));
	if(n != sizeof(r)){
                perror("read");
                exit(0);
	}
        close(fd);
        return(r);
}

--[ Disclosure timeline:

26/03/2019: Vulnerabilities discovered.
26/03/2019: Reported vulnerabilities to MITRE.
26/03/2019: Vulnerabilities assigned ids CVE-2016-10743 and CVE-2019-10064.
11/02/2020: Reported vulnerabilities to software author directly.
27/02/2020: Public disclosure.

--[ Credits:

This vulnerability was discovered by Nicolas Massaviol and Jonathan Brossard from Moabi.com

</pre>
</html>

